<!doctype html>
<html>
<head>
	<meta charset="utf-8">

	<!-- links to bootstrap and css -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="assets/css/landing-page.css" rel="stylesheet">

	<!-- link to ArcGIS -->
	<link rel="stylesheet" href="https://js.arcgis.com/4.3/esri/css/main.css">
	<link rel="stylesheet" href="https://js.arcgis.com/4.3/esri/themes/dark-purple/main.css">
	<script src="https://js.arcgis.com/4.3/"></script>
	<title>Cross|Over-Project</title>
	<base href="/">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" type="image/x-icon" href= "favicon.ico">

	<script type="text/javascript">
		require([
			"esri/tasks/Locator",
			"esri/Map",
			"esri/views/MapView",
			"esri/widgets/Locate",
			"esri/widgets/Search",
			"dojo/domReady!"
			], function(
				Locator,
				Map,
				MapView,
				Locate,
				Search) {

				var locatorTask = new Locator({
					url: "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"
				});

				var map = new Map({
					basemap: "streets"
				});

				var view = new MapView({
					scale: 123456789,
					container: "viewDiv",
					map: map,
					center: [-80, 35],
					zoom: 3
				});

				var locateBtn = new Locate({
					view: view
				});

				var searchWidget = new Search({
					view: view,
					fieldsInfos: {fieldName: "NEVMARR_CY"}
				});

				view.ui.add(locateBtn, {
					position: "top-left"
				});

				view.ui.add(searchWidget, {
					position: "top-left",
					index: 0
				});
				
				view.on("click", function(event) {
        // Get the coordinates of the click on the view
        var lat = Math.round(event.mapPoint.latitude * 1000) / 1000;
        var lon = Math.round(event.mapPoint.longitude * 1000) / 1000;

        view.popup.open({
          // Set the popup's title to the coordinates of the location
          title: "Reverse geocode: [" + lon + ", " + lat + "]",
          location: event.mapPoint // Set the location of the popup to the clicked location
        });

        // Display the popup
        // Execute a reverse geocode using the clicked location
        locatorTask.locationToAddress(event.mapPoint).then(function(
        	response) {
          // If an address is successfully found, print it to the popup's content
          var address = response.address.Match_addr;
          view.popup.content = address;
        }).otherwise(function(err) {
          // If the promise fails and no result is found, print a generic message
          // to the popup's content
          view.popup.content =
          "No address was found for this location";
        });
      });

			});
		</script>
	</head>

	<body>
		<app-root>Loading...</app-root>

		<script src="assets/js/jquery.js"></script>
		<script src="assets/js/bootstrap.js"></script>
	</body>
	</html>